<!---
  WARNING: This file was automatically generated
  DO NOT MODIFY THIS FILE DIRECTLY

  Changes to this file will be overwritten during the next generation.
  To make modifications, please edit the source files and regenerate.

  Generated by: cd doc && make doc
  Source Files: see make_readme.sh
-->

# Introduction

## What is it?

Spookipy is a collection of python algorithms that work with dataframes
obtained with fstpy or numpy arrays.

## Spookipy philosophy

These algorithms are generic in nature and all share a uniform model in
implementation. The idea is to use the interface to create new
algorithms.

# Requirements

## run time packages

-   fstpy\>=2025.03.00
-   pandas\>=1.5.1
-   numpy\>=1.24.4
-   xarray\>=2023.7.0
-   dask\>=2023.7.1

## developpement packages

-   fstpy\>=2025.03.00
-   ci_fstcomp\>=2025.01.00
-   pandas\>=1.5.1
-   numpy\>=1.24.4
-   xarray\>=2023.7.0
-   dask\>=2023.7.1
-   pytest\>=7.4.0
-   sphinx\>=5.3.0
-   sphinx_autodoc_typehints\>=1.21.8
-   sphinx_gallery\>=0.13.0
-   sphinx_rtd_theme\>=0.5.1
-   nbsphinx\>=0.9.2

## CMDS Python environment

This is an ssm package that we use at CMC on the science network and
that contains a wide variety of packages

``` bash
# use CMDS Python environment
. ssmuse-sh -p /fs/ssm/eccc/cmd/cmds/env/python/py310_2023.07.28_all
```

# Installation

Use the ssm package

    # SpookiPy and dependencies
    .  r.load.dot /fs/ssm/eccc/cmd/cmdw/PRIVATE/spookipy/bundle/20250300

## Using spookipy in scripts or Jupyter Lab/Notebook

``` bash
# use CMDS Python environment
. ssmuse-sh -p /fs/ssm/eccc/cmd/cmds/env/python/py310_2023.07.28_all
# SpookiPy and dependencies
.  r.load.dot /fs/ssm/eccc/cmd/cmdw/PRIVATE/spookipy/bundle/20250300
```

### use spookipy

``` python
# inside your script
import spookipy
uv_df = spookipy.windmodulus(df).compute()
```

### Example

``` python
data_path = prefix + '/data/'
import fstpy
import spookipy
# setup your file to read
records=fstpy.StandardFileReader(data_path + 'ttuvre.std').to_pandas()
# display selected records in a rpn voir format
fstpy.voir(records)
# compute uv on the selected records
uv_df = spookipy.windmodulus(records).compute()
dest_path = '/tmp/out.std'
# write the selected records to the output file
fstpy.StandardFileWriter(dest_path,uv_df).to_fst()
```

## Getting the source code

``` bash
git clone git@gitlab.science.gc.ca:cmdw-spooki/spookipy.git  
# create a new branch  
git checkout -b my_change  
# modify the code  
# commit your changes  
# fetch changes  
git fetch  
# merge recent master  
git merge origin/master  
# push your change  
git push origin my_change  
```

Then create a merge request on science\'s gitlab
<https://gitlab.science.gc.ca/cmdw-spooki/spookipy/merge_requests>

## Testing

``` bash
# use CMDS Python environment
. ssmuse-sh -p /fs/ssm/eccc/cmd/cmds/env/python/py310_2023.07.28_all
# FSTPY version and dependencies
. r.load.dot /fs/ssm/eccc/cmd/cmds/fstpy/bundle/20250300
# get ci_fstcomp 
. ssmuse-sh -d  /fs/ssm/eccc/cmd/cmds/apps/ci_fstcomp/202501/00
# From the $project_root/test directory of the project
python -m pytest  
```

## Building documentation

``` bash
# This will build documentation in docs/build and there you will find index.html  
# Make sure fstpy is in the PYTHONPATH 
# From the $project_root/doc directory of the project 
cd doc  
make clean 
make doc  
```

# Release

## Update release version number

``` bash
Update the version number in spookipy/__init__.py 
```

## Update configuration files

``` bash
Update the following configuration files:

   * cmds_python_env.txt:  CMDS python environment
   * fstpy_env.txt:  FSTPY and dependencies
   * ci_fstcomp.txt: ci_fstcomp version
```

## Build documentation

``` bash
cd doc  
make clean 
make doc  
```

## Commit changes

``` bash
Commit the following files:

* README.md
* fstpy_env.txt
* cmds_python_env.txt
* ci_fstcomp.txt
```

# Creating the ssm package

The \"\--yaml\" option can be used to determine which plugins will be
included in the ssm package.

``` bash
# This will build the ssm package. 
cd livraison  
./make_ssm_package.py  
or 
./make_ssm_package.py --yaml <plugin_list.yaml>
```
